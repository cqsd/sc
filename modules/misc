#!/bin/bash

_meta_short_help() {
    echo "Meta things (uncategorized)"
}

_meta() {
    echo "usage: $(basename $0) ${FUNCNAME[0]} subcommand"
    echo
    echo "available subcommands are:"
    echo "  list-profiles   - list aws profiles"
    echo "  show-pass       - show item in local keychain (OS X only)"
    echo '  xargs-edit (xe) - cut -d: -f1 | sort | uniq | xargs ${EDITOR:-vi}'
}

_meta_list-profiles() {
    if [ -f ~/.aws/config ]; then
        grep '\[.*\]' ~/.aws/config | sed -e 's/\[profile//g' -e 's/\]//g' | tr -d ' '
    else
        echo 'No ~/.aws/config' >&2
    fi
}

_meta_show-pass() {
    if [ $# -lt 1 ]; then
        echo 'usage: show-pass name'
        exit 1
    fi
    name=$1; shift
    security find-generic-password -s "$name" -w $*
}

_meta_xargs-edit() {
    cut -d: -f1 | sort | uniq | xargs ${EDITOR:-vi}
}

_meta_xe() {
    _meta_xargs-edit
}
